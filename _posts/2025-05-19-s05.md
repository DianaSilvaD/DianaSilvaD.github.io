---
title: Fase 1 - Preparación del Laboratorio 
date: 2025-05-19 00:00:00 -05:00
categories: [apt]
tags: [apt, virtual machine, wizard spider]
---

# Objetivos:

## 1. Crear VMs y configurar red

### 1.1. Maquinas virtuales 

| SO                                | Rol                | Nombre |Enlace de descarga                                                                                       |
|-----------------------------------|--------------------|--------|---------------------------------------------------------------------------------------------------------|
| Kali Linux 2019                   | Atacante           |attacker|<https://old.kali.org/kali-images/kali-2019.1a/>                                                         |
| Windows Server 2k19 - Build 17763 | Domain Controller  |wizard  |<https://archive.org/details/17763.3650.221105-1748.rs-5-release-svc-refresh-server-eval-x-64-fre-en-us> |
| Windows 10 - Build 19042          | User machine 1     |dorothy |<https://archive.org/details/windows-10-insider-preview-client-x-64-en-us-19042>                         |
| Windows 10 - Build 19042          | User machine 2     |toto    |<https://archive.org/details/windows-10-insider-preview-client-x-64-en-us-19042>                         |


### 1.2. **Kali Linux 2019 - attacker**

#### Creación de maquina virtual en el Virtual Box

- Configuración de Harware

    |Recurso       | Valor   |
    |--------------|---------|
    | Memoria base | 2048 MB |
    | Procesadores | 2 CPU   |
    | Disco        | 30 GB   |

- Acceder al botón crear en Virtula box
- Nombrar la VM y cargar la imagen ISO correspondiente
![image.png](/assets/images/2025-05-19-s05/Captura desde 2025-06-06 15-54-32.png)

- Hardware asignado a la VM
![image.png](/assets/images/2025-05-19-s05/Captura desde 2025-06-04 20-07-06.png)

- Disco duro
![image.png](/assets/images/2025-05-19-s05/Captura desde 2025-06-04 20-07-10.png)

- Al terminar ir a configuración de la VM
    - Expert → **General** → Avanzado → Portapapales compartido : Bidirecional
    - Expert → **General** → Avanzado → Arrastrar y soltar : Bidirecional
    - Expert → **Sistema** → Placa base → Orden de arranque: [✓] Óptica [✓]  Disco duro [ ] Disquete [ ] Red 
    - Expert → **Sistema** → Aceleración → Interfaz de paravirtualización: Hyper-V

- Configuración de red
    - Expert → **Red** → Adapatdor 1 → Conectado a: Red NAT
    ![image.png](/assets/images/2025-05-19-s05/Captura desde 2025-06-06 21-51-47.png)

    - Expert → **Red** → Adapatdor 2 → Conectado a: Red interna
    ![image.png](/assets/images/2025-05-19-s05/Captura desde 2025-06-06 21-51-52.png)

- Iniciar la VM para comenzar la instalación
    - Seleccionar Graphical install (instalación grafica)
    ![image.png](/assets/images/2025-05-19-s05/Captura desde 2025-06-04 20-09-38.png)

    - Nombrar a la VM - **attacker**
    ![image.png](/assets/images/2025-05-19-s05/Captura desde 2025-06-06 15-10-45.png)
    
    - Partición de discos
    ![image.png](/assets/images/2025-05-19-s05/Captura desde 2025-06-06 15-12-16.png) 
    ![image.png](/assets/images/2025-05-19-s05/Captura desde 2025-06-06 15-12-30.png)
    
    - Seleecionar el arranque GRUB 
    ![image.png](/assets/images/2025-05-19-s05/Captura desde 2025-06-06 16-13-19.png)    

    - Comienza la instalación del disco
    ![image.png](/assets/images/2025-05-19-s05/Captura desde 2025-06-06 15-58-17.png)

    - Termino de la intalación
    ![image.png](/assets/images/2025-05-19-s05/Captura desde 2025-06-06 16-13-50.png)





#### Version de Kali linux    
```bash
    lsb_release -a
```
![figura](/assets/images/2025-05-19-s05/Captura de pantalla 2025-05-22 124140.png)
    
#### Hostname
```bash
    hostname
```
![figura](/assets/images/2025-05-19-s05/Captura de pantalla 2025-05-23 142812.png)

#### Asignar **IP `192.168.0.4`**

```bash
sudo ip addr add 192.168.0.4/24 dev eth0
sudo ip link set eth0 up
```
![image.png](/assets/images/2025-05-19-s05/Captura de pantalla 2025-05-23 141337.png)
            

#### Git
```bash
    sudo apt update
```
    
```bash
    sudo apt install git -y
```
    
```bash
    git --version
```
    
![image.png](/assets/images/2025-05-19-s05/Captura de pantalla 2025-05-22 125302.png)
        
#### Clonar Repositorio    
```bash
git clone https://github.com/center-for-threat-informed-defense/adversary_emulation_library.git
```
    
#### Python
```bash
python3 --version
```
![image.png](/assets/images/2025-05-19-s05/Captura de pantalla 2025-05-22 163739.png)
    

#### Infrastructure

<https://github.com/center-for-threat-informed-defense/adversary_emulation_library/blob/4a57b3dd5d28ad1bd79e927e04b20fd4d66934a0/wizard_spider/Emulation_Plan/Scenario_1/Infrastructure.md>
        
    
1. Ingresar a **`wizard_spider`** del repositorio clonado
        
    ```bash
        root@attacker:~/Downloads/adversary_emulation_library/wizard_spider#         
    ```
            
2. Instalar **`pyminizip`** para descomprimir los archivos zip.
        
    ```bash
        pip3 install pyminizip
    ```
    ![image.png](/assets/images/2025-05-19-s05/Captura de pantalla 2025-05-24 011953.png)
        
        
3. Descifrar el script
        
    El siguiente script para descifra automáticamente estos archivos:
            
    ```bash
        root@attacker:~/Downloads/adversary_emulation_library/wizard_spider# python3 Resources/Utilities/crypt_executables.py -i ./ -p malware --decrypt
    ```
    ![image.png](/assets/images/2025-05-19-s05/Captura de pantalla 2025-05-24 012022.png)  

    ![image.png](/assets/images/2025-05-19-s05/Captura de pantalla 2025-05-24 140212.png)  

    - 



4. Conectarse al Domain Controller vía RDP


```bash
xfreerdp +clipboard /u:oz\\administrator /p:"P@ssw0rd123" /v:10.0.0.4 /drive:X,wizard_spider/Resources/setup /cert-ignore

```
    


### 1.3. **Windows Server 2k19 - Build 17763 - wizard**


#### Version Windows Server 2k19   
```bash
    winver
```
![figura](/assets/images/2025-05-19-s05/Captura de pantalla 2025-05-23 185538.png)
    
#### Hostname
```bash
    hostname
```
![figura](/assets/images/2025-05-19-s05/Captura de pantalla 2025-05-23 172831.png)

#### Asignar **IP `10.0.0.4`**

![image.png](/assets/images/2025-05-19-s05/Captura de pantalla 2025-05-23 205026.png)
            
#### Agregar roles y caracteristicas al servidor
1. En Tools seleccionar Add Roles an Features Wizard
2. Proceder a la instalación
    ![image.png](/assets/images/2025-05-19-s05/Captura de pantalla 2025-05-23 212504.png)

    ![image.png](/assets/images/2025-05-19-s05/Captura de pantalla 2025-05-23 212511.png)

    ![image.png](/assets/images/2025-05-19-s05/Captura de pantalla 2025-05-23 212628.png)   
    
    ![image.png](/assets/images/2025-05-19-s05/Captura de pantalla 2025-05-23 212737.png)
    
    ![image.png](/assets/images/2025-05-19-s05/Captura de pantalla 2025-05-23 212818.png)

        
    ![image.png](/assets/images/2025-05-19-s05/Captura de pantalla 2025-05-23 212842.png)

        
    ![image.png](/assets/images/2025-05-19-s05/Captura de pantalla 2025-05-23 213214.png)

        
    ![image.png](/assets/images/2025-05-19-s05/Captura de pantalla 2025-05-23 213325.png)

#### Promover el servidor a servidor de dominio

![image.png](/assets/images/2025-05-19-s05/Captura de pantalla 2025-05-23 213450.png)

![image.png](/assets/images/2025-05-19-s05/Captura de pantalla 2025-05-23 213500.png)

#### Asistente de configuración de servicios de dominio de Active Directory

![image.png](/assets/images/2025-05-19-s05/Captura de pantalla 2025-05-23 214311.png)

![image.png](/assets/images/2025-05-19-s05/Captura de pantalla 2025-05-23 214852.png)


![image.png](/assets/images/2025-05-19-s05/Captura de pantalla 2025-05-23 214915.png)


![image.png](/assets/images/2025-05-19-s05/Captura de pantalla 2025-05-23 214943.png)


![image.png](/assets/images/2025-05-19-s05/Captura de pantalla 2025-05-23 215032.png)


![image.png](/assets/images/2025-05-19-s05/Captura de pantalla 2025-05-23 215058.png)


![image.png](/assets/images/2025-05-19-s05/Captura de pantalla 2025-05-23 215121.png)


![image.png](/assets/images/2025-05-19-s05/Captura de pantalla 2025-05-23 215159.png)


![image.png](/assets/images/2025-05-19-s05/Captura de pantalla 2025-05-23 215228.png)


#### Consultar qué controlador de dominio tiene cada uno de los roles FSMO (Flexible Single Master Operations) en un entorno de Active Directory.

![image.png](/assets/images/2025-05-19-s05/Captura de pantalla 2025-05-23 233112.png)

#### Hacer ping desde el mismo servidor de dominio

![image.png](/assets/images/2025-05-19-s05/Captura de pantalla 2025-05-23 233455.png)


-





### 1.4. **Windows 10 - Build 19042 - dorothy**

#### Asignar el dominio **oz.local** 

![image.png](/assets/images/2025-05-19-s05/Captura de pantalla 2025-05-23 234324.png)

![image.png](/assets/images/2025-05-19-s05/Captura de pantalla 2025-05-23 235327.png)

![image.png](/assets/images/2025-05-19-s05/Captura de pantalla 2025-05-23 235342.png)

![image.png](/assets/images/2025-05-19-s05/Captura de pantalla 2025-05-24 001537.png)


### 1.5. **Windows 10 - Build 19042 - toto**

#### Asignar el dominio **oz.local**
![image.png](/assets/images/2025-05-19-s05/Captura de pantalla 2025-05-24 001904.png)

![image.png](/assets/images/2025-05-19-s05/Captura de pantalla 2025-05-24 001949.png)

![image.png](/assets/images/2025-05-19-s05/Captura de pantalla 2025-05-24 002009.png)

![image.png](/assets/images/2025-05-19-s05/Captura de pantalla 2025-05-24 002302.png)


<!--
# Título 1
## Título 2
### Título 3
#### Título 4
!-->

<!--
**Negrita**
*Cursiva*
~~Tachado~~
`Código en línea`
!-->

<!--
- [ ] Tarea pendiente
- [x] Tarea completada
!-->

<!--
```python
def saludar():
    print("Hola mundo")
```
<!-- [Texto visible](https://example.com ) <!--

<!-- [Descargar archivo](./ruta/archivo.pdf)
 <!--

<!--
![Texto alternativo](https://ruta.com/imagen.png)
!-->

<!-- ![figura](/assets/images/2025-05-19-s05/IMG_20240302_215057.jpg) -->
